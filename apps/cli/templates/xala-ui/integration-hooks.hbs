#!/bin/bash
# {{hookType}} Hook for Xala UI Integration
# Generated by Xaheen CLI v2 - Xala UI Integration

{{#if_eq hookType 'pre-build'}}
echo "ğŸ¨ Pre-build: Validating Xala UI components..."

# Validate semantic architecture compliance
echo "  âœ“ Checking zero raw HTML policy..."
xaheen validate --ui --semantic --zero-html

# Validate localization compliance
echo "  âœ“ Checking mandatory localization..."
xaheen validate --ui --localization --mandatory

# Validate accessibility compliance
echo "  âœ“ Checking WCAG 2.2 AAA compliance..."
xaheen validate --ui --accessibility --wcag-aaa

# Validate design token usage
echo "  âœ“ Checking design token usage..."
xaheen validate --ui --design-tokens

{{#if enterprise}}
# Enterprise compliance checks
echo "  âœ“ Running enterprise compliance checks..."
xaheen validate --compliance --norwegian --gdpr --iso27001
{{/if}}

# Exit with error if validation fails
if [ $? -ne 0 ]; then
  echo "âŒ Pre-build validation failed. Please fix issues before building."
  exit 1
fi

echo "âœ… Pre-build validation completed successfully!"
{{/if_eq}}

{{#if_eq hookType 'post-generate'}}
echo "ğŸ”§ Post-generate: Processing generated components..."

# Format generated code
if command -v prettier &> /dev/null; then
  echo "  âœ“ Formatting generated code with Prettier..."
  prettier --write "src/components/**/*.{ts,tsx,js,jsx,vue,svelte}"
fi

# Lint generated code
if command -v eslint &> /dev/null; then
  echo "  âœ“ Linting generated code..."
  eslint --fix "src/components/**/*.{ts,tsx,js,jsx,vue,svelte}" --quiet
fi

# Type check generated code
{{#if typescript}}
if command -v tsc &> /dev/null; then
  echo "  âœ“ Type checking generated code..."
  tsc --noEmit --skipLibCheck
fi
{{/if}}

# Update component index files
echo "  âœ“ Updating component exports..."
xaheen utils --update-exports --components

# Run tests for generated components
{{#if withTests}}
echo "  âœ“ Running tests for generated components..."
{{packageManager}} run test -- --testPathPattern="src/components" --passWithNoTests
{{/if}}

echo "âœ… Post-generate processing completed!"
{{/if_eq}}

{{#if_eq hookType 'pre-localize'}}
echo "ğŸŒ Pre-localize: Preparing localization extraction..."

# Extract translation keys from components
echo "  âœ“ Extracting translation keys..."
xaheen localization --extract --components "src/components"

# Validate existing translations
echo "  âœ“ Validating existing translations..."
xaheen validate --localization --coverage

# Check for missing translations
echo "  âœ“ Checking for missing translations..."
xaheen localization --check-missing

{{#each supportedLocales}}
# Validate {{this}} locale
echo "  âœ“ Validating {{this}} locale..."
xaheen localization --validate --locale {{this}}
{{/each}}

echo "âœ… Pre-localize preparation completed!"
{{/if_eq}}

{{#if_eq hookType 'deploy'}}
echo "ğŸš€ Pre-deploy: Final Xala UI compliance check..."

# Complete validation suite
echo "  âœ“ Running complete validation suite..."
xaheen validate --ui --complete --strict

# Performance audit
echo "  âœ“ Running performance audit..."
xaheen audit --performance --ui-components

# Security audit
echo "  âœ“ Running security audit..."
xaheen audit --security --components

# Generate compliance report
echo "  âœ“ Generating compliance report..."
xaheen validate --compliance --report --export-pdf

echo "âœ… Deploy validation completed - Ready for production!"
{{/if_eq}}