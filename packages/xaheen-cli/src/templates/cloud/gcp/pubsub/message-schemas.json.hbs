{
  "schemas": {
    "user-event-schema": {
      "type": "AVRO",
      "definition": {
        "type": "record",
        "name": "UserEvent",
        "namespace": "{{projectName}}.events.user",
        "fields": [
          {
            "name": "id",
            "type": "string",
            "doc": "Unique event identifier"
          },
          {
            "name": "type",
            "type": {
              "type": "enum",
              "name": "UserEventType",
              "symbols": [
                "USER_CREATED",
                "USER_UPDATED", 
                "USER_DELETED",
                "USER_ACTIVATED",
                "USER_DEACTIVATED",
                "USER_PASSWORD_CHANGED",
                "USER_EMAIL_VERIFIED",
                "USER_PHONE_VERIFIED",
                "USER_MFA_ENABLED",
                "USER_MFA_DISABLED",
                "USER_LOGIN",
                "USER_LOGOUT",
                "USER_GDPR_CONSENT_GRANTED",
                "USER_GDPR_CONSENT_REVOKED",
                "USER_DATA_EXPORT_REQUESTED",
                "USER_DATA_DELETION_REQUESTED"
              ]
            },
            "doc": "Type of user event"
          },
          {
            "name": "userId",
            "type": "string",
            "doc": "User identifier"
          },
          {
            "name": "timestamp",
            "type": "long",
            "logicalType": "timestamp-millis",
            "doc": "Event timestamp in milliseconds"
          },
          {
            "name": "source",
            "type": "string",
            "doc": "Source service or system that generated the event"
          },
          {
            "name": "version",
            "type": "string",
            "default": "1.0",
            "doc": "Schema version"
          },
          {
            "name": "correlationId",
            "type": ["null", "string"],
            "default": null,
            "doc": "Correlation ID for request tracking"
          },
          {
            "name": "sessionId",
            "type": ["null", "string"],
            "default": null,
            "doc": "User session identifier"
          },
          {
            "name": "data",
            "type": {
              "type": "record",
              "name": "UserEventData",
              "fields": [
                {
                  "name": "email",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "name",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "role",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "organizationId",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "personalNumber",
                  "type": ["null", "string"],
                  "default": null,
                  "doc": "Norwegian personal number (encrypted)"
                },
                {
                  "name": "ipAddress",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "userAgent",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "location",
                  "type": [
                    "null",
                    {
                      "type": "record",
                      "name": "Location",
                      "fields": [
                        {"name": "country", "type": "string"},
                        {"name": "city", "type": ["null", "string"], "default": null},
                        {"name": "latitude", "type": ["null", "double"], "default": null},
                        {"name": "longitude", "type": ["null", "double"], "default": null}
                      ]
                    }
                  ],
                  "default": null
                },
                {
                  "name": "metadata",
                  "type": {
                    "type": "map",
                    "values": "string"
                  },
                  "default": {}
                }
              ]
            },
            "doc": "Event-specific data"
          }
        ]
      }
    },

    "organization-event-schema": {
      "type": "AVRO",
      "definition": {
        "type": "record",
        "name": "OrganizationEvent",
        "namespace": "{{projectName}}.events.organization",
        "fields": [
          {
            "name": "id",
            "type": "string"
          },
          {
            "name": "type",
            "type": {
              "type": "enum",
              "name": "OrganizationEventType",
              "symbols": [
                "ORGANIZATION_CREATED",
                "ORGANIZATION_UPDATED",
                "ORGANIZATION_DELETED",
                "ORGANIZATION_ACTIVATED",
                "ORGANIZATION_DEACTIVATED",
                "ORGANIZATION_MEMBER_ADDED",
                "ORGANIZATION_MEMBER_REMOVED",
                "ORGANIZATION_MEMBER_ROLE_CHANGED",
                "ORGANIZATION_SUBSCRIPTION_CHANGED",
                "ORGANIZATION_BILLING_UPDATED",
                "ORGANIZATION_SETTINGS_CHANGED"
              ]
            }
          },
          {
            "name": "organizationId",
            "type": "string"
          },
          {
            "name": "timestamp",
            "type": "long",
            "logicalType": "timestamp-millis"
          },
          {
            "name": "source",
            "type": "string"
          },
          {
            "name": "version",
            "type": "string",
            "default": "1.0"
          },
          {
            "name": "correlationId",
            "type": ["null", "string"],
            "default": null
          },
          {
            "name": "userId",
            "type": ["null", "string"],
            "default": null,
            "doc": "User who triggered the event"
          },
          {
            "name": "data",
            "type": {
              "type": "record",
              "name": "OrganizationEventData",
              "fields": [
                {
                  "name": "name",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "orgNumber",
                  "type": ["null", "string"],
                  "default": null,
                  "doc": "Norwegian organization number"
                },
                {
                  "name": "contactEmail",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "address",
                  "type": [
                    "null",
                    {
                      "type": "record",
                      "name": "Address",
                      "fields": [
                        {"name": "street", "type": "string"},
                        {"name": "city", "type": "string"},
                        {"name": "postalCode", "type": "string"},
                        {"name": "country", "type": "string"}
                      ]
                    }
                  ],
                  "default": null
                },
                {
                  "name": "subscription",
                  "type": [
                    "null",
                    {
                      "type": "record",
                      "name": "Subscription",
                      "fields": [
                        {"name": "plan", "type": {"type": "enum", "name": "SubscriptionPlan", "symbols": ["FREE", "PRO", "ENTERPRISE"]}},
                        {"name": "status", "type": {"type": "enum", "name": "SubscriptionStatus", "symbols": ["ACTIVE", "CANCELLED", "EXPIRED", "TRIAL"]}},
                        {"name": "startDate", "type": "long", "logicalType": "timestamp-millis"},
                        {"name": "endDate", "type": ["null", "long"], "logicalType": "timestamp-millis", "default": null}
                      ]
                    }
                  ],
                  "default": null
                },
                {
                  "name": "memberData",
                  "type": [
                    "null",
                    {
                      "type": "record",
                      "name": "MemberData",
                      "fields": [
                        {"name": "memberId", "type": "string"},
                        {"name": "role", "type": {"type": "enum", "name": "MemberRole", "symbols": ["OWNER", "ADMIN", "MEMBER", "VIEWER"]}},
                        {"name": "permissions", "type": {"type": "array", "items": "string"}, "default": []}
                      ]
                    }
                  ],
                  "default": null
                },
                {
                  "name": "metadata",
                  "type": {
                    "type": "map",
                    "values": "string"
                  },
                  "default": {}
                }
              ]
            }
          }
        ]
      }
    },

    "project-event-schema": {
      "type": "AVRO", 
      "definition": {
        "type": "record",
        "name": "ProjectEvent",
        "namespace": "{{projectName}}.events.project",
        "fields": [
          {
            "name": "id",
            "type": "string"
          },
          {
            "name": "type",
            "type": {
              "type": "enum",
              "name": "ProjectEventType",
              "symbols": [
                "PROJECT_CREATED",
                "PROJECT_UPDATED",
                "PROJECT_DELETED",
                "PROJECT_ARCHIVED",
                "PROJECT_UNARCHIVED",
                "PROJECT_MEMBER_ADDED",
                "PROJECT_MEMBER_REMOVED",
                "PROJECT_MEMBER_ROLE_CHANGED",
                "PROJECT_VISIBILITY_CHANGED",
                "PROJECT_SETTINGS_CHANGED",
                "PROJECT_DOCUMENT_ADDED",
                "PROJECT_DOCUMENT_UPDATED",
                "PROJECT_DOCUMENT_DELETED",
                "PROJECT_COMMENT_ADDED"
              ]
            }
          },
          {
            "name": "projectId",
            "type": "string"
          },
          {
            "name": "organizationId",
            "type": "string"
          },
          {
            "name": "timestamp",
            "type": "long",
            "logicalType": "timestamp-millis"
          },
          {
            "name": "source",
            "type": "string"
          },
          {
            "name": "version",
            "type": "string",
            "default": "1.0"
          },
          {
            "name": "correlationId",
            "type": ["null", "string"],
            "default": null
          },
          {
            "name": "userId",
            "type": ["null", "string"],
            "default": null
          },
          {
            "name": "data",
            "type": {
              "type": "record",
              "name": "ProjectEventData",
              "fields": [
                {
                  "name": "name",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "description",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "status",
                  "type": ["null", {"type": "enum", "name": "ProjectStatus", "symbols": ["ACTIVE", "ARCHIVED", "DELETED"]}],
                  "default": null
                },
                {
                  "name": "visibility",
                  "type": ["null", {"type": "enum", "name": "ProjectVisibility", "symbols": ["PRIVATE", "ORGANIZATION", "PUBLIC"]}],
                  "default": null
                },
                {
                  "name": "tags",
                  "type": {"type": "array", "items": "string"},
                  "default": []
                },
                {
                  "name": "memberData",
                  "type": [
                    "null",
                    {
                      "type": "record", 
                      "name": "ProjectMemberData",
                      "fields": [
                        {"name": "memberId", "type": "string"},
                        {"name": "role", "type": {"type": "enum", "name": "ProjectMemberRole", "symbols": ["OWNER", "ADMIN", "EDITOR", "VIEWER"]}},
                        {"name": "permissions", "type": {"type": "array", "items": "string"}, "default": []}
                      ]
                    }
                  ],
                  "default": null
                },
                {
                  "name": "documentData",
                  "type": [
                    "null",
                    {
                      "type": "record",
                      "name": "DocumentData", 
                      "fields": [
                        {"name": "documentId", "type": "string"},
                        {"name": "filename", "type": "string"},
                        {"name": "contentType", "type": "string"},
                        {"name": "size", "type": "long"}
                      ]
                    }
                  ],
                  "default": null
                },
                {
                  "name": "metadata",
                  "type": {
                    "type": "map",
                    "values": "string"
                  },
                  "default": {}
                }
              ]
            }
          }
        ]
      }
    },

    "notification-event-schema": {
      "type": "AVRO",
      "definition": {
        "type": "record",
        "name": "NotificationEvent",
        "namespace": "{{projectName}}.events.notification",
        "fields": [
          {
            "name": "id",
            "type": "string"
          },
          {
            "name": "type",
            "type": {
              "type": "enum",
              "name": "NotificationEventType", 
              "symbols": [
                "NOTIFICATION_SEND",
                "NOTIFICATION_DELIVERED",
                "NOTIFICATION_FAILED",
                "NOTIFICATION_OPENED",
                "NOTIFICATION_CLICKED"
              ]
            }
          },
          {
            "name": "recipientId",
            "type": "string"
          },
          {
            "name": "timestamp",
            "type": "long",
            "logicalType": "timestamp-millis"
          },
          {
            "name": "source",
            "type": "string"
          },
          {
            "name": "version",
            "type": "string",
            "default": "1.0"
          },
          {
            "name": "correlationId",
            "type": ["null", "string"],
            "default": null
          },
          {
            "name": "data",
            "type": {
              "type": "record",
              "name": "NotificationEventData",
              "fields": [
                {
                  "name": "notificationType",
                  "type": {
                    "type": "enum",
                    "name": "NotificationType",
                    "symbols": ["EMAIL", "PUSH", "SMS", "IN_APP"]
                  }
                },
                {
                  "name": "template",
                  "type": "string"
                },
                {
                  "name": "subject",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "content",
                  "type": "string"
                },
                {
                  "name": "priority",
                  "type": {
                    "type": "enum",
                    "name": "NotificationPriority",
                    "symbols": ["LOW", "NORMAL", "HIGH", "URGENT"]
                  },
                  "default": "NORMAL"
                },
                {
                  "name": "category",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "actionUrl",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "expiresAt",
                  "type": ["null", "long"],
                  "logicalType": "timestamp-millis",
                  "default": null
                },
                {
                  "name": "personalizedData",
                  "type": {
                    "type": "map",
                    "values": "string"
                  },
                  "default": {}
                },
                {
                  "name": "metadata",
                  "type": {
                    "type": "map", 
                    "values": "string"
                  },
                  "default": {}
                }
              ]
            }
          }
        ]
      }
    },

    "audit-event-schema": {
      "type": "AVRO",
      "definition": {
        "type": "record",
        "name": "AuditEvent",
        "namespace": "{{projectName}}.events.audit",
        "fields": [
          {
            "name": "id",
            "type": "string"
          },
          {
            "name": "type",
            "type": {
              "type": "enum",
              "name": "AuditEventType",
              "symbols": [
                "AUDIT_LOG",
                "SECURITY_EVENT",
                "COMPLIANCE_EVENT",
                "DATA_ACCESS",
                "DATA_MODIFICATION",
                "SYSTEM_EVENT",
                "USER_ACTION"
              ]
            }
          },
          {
            "name": "userId",
            "type": ["null", "string"],
            "default": null
          },
          {
            "name": "timestamp",
            "type": "long",
            "logicalType": "timestamp-millis"
          },
          {
            "name": "source",
            "type": "string"
          },
          {
            "name": "version",
            "type": "string",
            "default": "1.0"
          },
          {
            "name": "correlationId",
            "type": ["null", "string"],
            "default": null
          },
          {
            "name": "sessionId",
            "type": ["null", "string"],
            "default": null
          },
          {
            "name": "data",
            "type": {
              "type": "record",
              "name": "AuditEventData",
              "fields": [
                {
                  "name": "action",
                  "type": "string"
                },
                {
                  "name": "resource",
                  "type": "string"
                },
                {
                  "name": "resourceId",
                  "type": "string"
                },
                {
                  "name": "organizationId",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "projectId",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "ipAddress",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "userAgent",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "location",
                  "type": [
                    "null",
                    {
                      "type": "record",
                      "name": "AuditLocation",
                      "fields": [
                        {"name": "country", "type": "string"},
                        {"name": "city", "type": ["null", "string"], "default": null}
                      ]
                    }
                  ],
                  "default": null
                },
                {
                  "name": "result",
                  "type": {
                    "type": "enum",
                    "name": "AuditResult",
                    "symbols": ["SUCCESS", "FAILURE", "ERROR", "UNAUTHORIZED", "FORBIDDEN"]
                  }
                },
                {
                  "name": "riskLevel",
                  "type": {
                    "type": "enum",
                    "name": "RiskLevel", 
                    "symbols": ["LOW", "MEDIUM", "HIGH", "CRITICAL"]
                  },
                  "default": "LOW"
                },
                {
                  "name": "gdprRelevant",
                  "type": "boolean",
                  "default": false
                },
                {
                  "name": "personalDataAccessed",
                  "type": "boolean",
                  "default": false
                },
                {
                  "name": "changes",
                  "type": [
                    "null",
                    {
                      "type": "record",
                      "name": "DataChanges",
                      "fields": [
                        {"name": "before", "type": {"type": "map", "values": "string"}, "default": {}},
                        {"name": "after", "type": {"type": "map", "values": "string"}, "default": {}}
                      ]
                    }
                  ],
                  "default": null
                },
                {
                  "name": "metadata",
                  "type": {
                    "type": "map",
                    "values": "string"
                  },
                  "default": {}
                }
              ]
            }
          }
        ]
      }
    },

    "payment-event-schema": {
      "type": "AVRO",
      "definition": {
        "type": "record",
        "name": "PaymentEvent",
        "namespace": "{{projectName}}.events.payment",
        "fields": [
          {
            "name": "id", 
            "type": "string"
          },
          {
            "name": "type",
            "type": {
              "type": "enum",
              "name": "PaymentEventType",
              "symbols": [
                "PAYMENT_INITIATED",
                "PAYMENT_AUTHORIZED",
                "PAYMENT_CAPTURED",
                "PAYMENT_COMPLETED",
                "PAYMENT_FAILED",
                "PAYMENT_CANCELLED",
                "PAYMENT_REFUNDED", 
                "PAYMENT_DISPUTE_CREATED",
                "PAYMENT_DISPUTE_RESOLVED"
              ]
            }
          },
          {
            "name": "paymentId",
            "type": "string"
          },
          {
            "name": "userId",
            "type": "string"
          },
          {
            "name": "timestamp",
            "type": "long",
            "logicalType": "timestamp-millis"
          },
          {
            "name": "source",
            "type": "string"
          },
          {
            "name": "version",
            "type": "string",
            "default": "1.0"
          },
          {
            "name": "correlationId",
            "type": ["null", "string"],
            "default": null
          },
          {
            "name": "data",
            "type": {
              "type": "record",
              "name": "PaymentEventData",
              "fields": [
                {
                  "name": "amount",
                  "type": "long",
                  "doc": "Amount in cents/Ã¸re"
                },
                {
                  "name": "currency",
                  "type": "string",
                  "default": "NOK"
                },
                {
                  "name": "provider",
                  "type": {
                    "type": "enum",
                    "name": "PaymentProvider",
                    "symbols": ["VIPPS", "STRIPE", "KLARNA", "NETS", "PAYPAL"]
                  }
                },
                {
                  "name": "providerTransactionId",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "organizationId",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "subscriptionId",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "invoiceId",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "description",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "paymentMethod",
                  "type": [
                    "null",
                    {
                      "type": "record",
                      "name": "PaymentMethod",
                      "fields": [
                        {"name": "type", "type": {"type": "enum", "name": "PaymentMethodType", "symbols": ["CARD", "BANK_TRANSFER", "MOBILE", "WALLET"]}},
                        {"name": "last4", "type": ["null", "string"], "default": null},
                        {"name": "brand", "type": ["null", "string"], "default": null},
                        {"name": "country", "type": ["null", "string"], "default": null}
                      ]
                    }
                  ],
                  "default": null
                },
                {
                  "name": "failureReason",
                  "type": ["null", "string"],
                  "default": null
                },
                {
                  "name": "riskScore",
                  "type": ["null", "int"],
                  "default": null
                },
                {
                  "name": "fraudDetected",
                  "type": "boolean",
                  "default": false
                },
                {
                  "name": "metadata",
                  "type": {
                    "type": "map",
                    "values": "string"
                  },
                  "default": {}
                }
              ]
            }
          }
        ]
      }
    }
  },

  "topicSchemas": {
    "user-events": "user-event-schema",
    "organization-events": "organization-event-schema", 
    "project-events": "project-event-schema",
    "notifications": "notification-event-schema",
    "audit-logs": "audit-event-schema",
    "payments": "payment-event-schema"
  },

  "retentionPolicies": {
    "user-events": "7d",
    "organization-events": "30d",
    "project-events": "30d", 
    "notifications": "3d",
    "audit-logs": "2555d",
    "payments": "2555d"
  }
}