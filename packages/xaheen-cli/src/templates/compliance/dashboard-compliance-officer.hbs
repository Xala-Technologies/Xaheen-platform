<!DOCTYPE html>
<html lang="{{#if (eq language 'nb-NO')}}nb{{else}}en{{/if}}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{translations.title}} - {{#if (eq language 'nb-NO')}}Etterlevelsesansvarlig Rapport{{else}}Compliance Officer Report{{/if}}</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .gradient-bg { background: linear-gradient(135deg, #065f46 0%, #047857 100%); }
        .chart-container { position: relative; height: 300px; }
        .regulatory-item { border-left: 4px solid #10b981; background: linear-gradient(90deg, #f0fdf4 0%, #ffffff 100%); }
        .risk-critical { border-left-color: #dc2626; background: linear-gradient(90deg, #fef2f2 0%, #ffffff 100%); }
        .risk-high { border-left-color: #ea580c; background: linear-gradient(90deg, #fff7ed 0%, #ffffff 100%); }
        .risk-medium { border-left-color: #d97706; background: linear-gradient(90deg, #fffbeb 0%, #ffffff 100%); }
        .compliance-badge { display: inline-flex; align-items: center; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; font-weight: 500; }
        .compliance-excellent { background: #dcfce7; color: #166534; }
        .compliance-good { background: #dbeafe; color: #1e40af; }
        .compliance-warning { background: #fef3c7; color: #92400e; }
        .compliance-poor { background: #fee2e2; color: #991b1b; }
        .timeline-item { position: relative; padding-left: 2rem; }
        .timeline-item::before { content: ''; position: absolute; left: 0.5rem; top: 0.5rem; width: 0.75rem; height: 0.75rem; border-radius: 50%; background: #10b981; }
        .timeline-overdue::before { background: #dc2626; }
        .timeline-upcoming::before { background: #f59e0b; }
        .audit-trail { font-family: 'Courier New', monospace; background: #f8fafc; border: 1px solid #e2e8f0; }
        @media print {
            .no-print { display: none !important; }
            body { print-color-adjust: exact; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-6 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold mb-2">{{translations.title}}</h1>
                    <p class="text-green-100">{{#if (eq language 'nb-NO')}}Etterlevelsesansvarlig Rapport - Regelverksoversikt{{else}}Compliance Officer Report - Regulatory Overview{{/if}}</p>
                </div>
                <div class="text-right">
                    <div class="flex items-center space-x-4 mb-2">
                        <button onclick="generateAuditReport()" class="bg-emerald-600 hover:bg-emerald-700 px-4 py-2 rounded-lg text-sm font-medium no-print">
                            {{#if (eq language 'nb-NO')}}Audit Rapport{{else}}Audit Report{{/if}}
                        </button>
                        <button onclick="exportCompliance()" class="bg-teal-600 hover:bg-teal-700 px-4 py-2 rounded-lg text-sm font-medium no-print">
                            {{#if (eq language 'nb-NO')}}Eksporter PDF{{else}}Export PDF{{/if}}
                        </button>
                    </div>
                    <p class="text-green-100 text-sm">{{translations.lastUpdated}}</p>
                    <p class="text-white font-medium">{{formatDate generatedAt}}</p>
                </div>
            </div>
        </div>
    </header>

    <div class="max-w-7xl mx-auto px-6 py-8">
        <!-- Regulatory Compliance Overview -->
        <div class="mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-6">
                    {{#if (eq language 'nb-NO')}}Regelverks Etterlevelse Oversikt{{else}}Regulatory Compliance Overview{{/if}}
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- GDPR Status -->
                    <div class="regulatory-item p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">GDPR</h3>
                            <span class="compliance-badge {{#if (gte metrics.gdpr.complianceScore 85)}}compliance-excellent{{else if (gte metrics.gdpr.complianceScore 70)}}compliance-good{{else if (gte metrics.gdpr.complianceScore 50)}}compliance-warning{{else}}compliance-poor{{/if}}">
                                {{metrics.gdpr.complianceScore}}%
                            </span>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center text-sm">
                                <span class="w-4 h-4 rounded-full {{#if metrics.gdpr.dataProtectionOfficer}}bg-green-500{{else}}bg-red-500{{/if}} mr-2"></span>
                                <span class="text-gray-700">
                                    {{#if (eq language 'nb-NO')}}Personvernombud{{else}}Data Protection Officer{{/if}}
                                </span>
                            </div>
                            <div class="flex items-center text-sm">
                                <span class="w-4 h-4 rounded-full {{#if metrics.gdpr.privacyByDesign}}bg-green-500{{else}}bg-red-500{{/if}} mr-2"></span>
                                <span class="text-gray-700">
                                    {{#if (eq language 'nb-NO')}}Personvern ved design{{else}}Privacy by Design{{/if}}
                                </span>
                            </div>
                            <div class="flex items-center text-sm">
                                <span class="w-4 h-4 rounded-full {{#if metrics.gdpr.dataBreachProcedures}}bg-green-500{{else}}bg-red-500{{/if}} mr-2"></span>
                                <span class="text-gray-700">
                                    {{#if (eq language 'nb-NO')}}Databrudd prosedyrer{{else}}Data Breach Procedures{{/if}}
                                </span>
                            </div>
                        </div>
                        <div class="mt-4 text-xs text-gray-500">
                            {{#if (eq language 'nb-NO')}}Siste vurdering: {{formatDate metrics.timestamp}}{{else}}Last assessment: {{formatDate metrics.timestamp}}{{/if}}
                        </div>
                    </div>

                    <!-- NSM Security -->
                    <div class="regulatory-item {{#if (lt metrics.nsm.riskScore 50)}}{{else if (lt metrics.nsm.riskScore 75)}}risk-medium{{else}}risk-high{{/if}} p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">NSM</h3>
                            <span class="compliance-badge {{#if (eq metrics.nsm.certificationStatus 'certified')}}compliance-excellent{{else if (eq metrics.nsm.certificationStatus 'in-progress')}}compliance-warning{{else}}compliance-poor{{/if}}">
                                {{#if (eq language 'nb-NO')}}
                                    {{#if (eq metrics.nsm.certificationStatus 'certified')}}Sertifisert{{else if (eq metrics.nsm.certificationStatus 'in-progress')}}Pågående{{else}}Ikke sertifisert{{/if}}
                                {{else}}
                                    {{capitalize metrics.nsm.certificationStatus}}
                                {{/if}}
                            </span>
                        </div>
                        <div class="space-y-3">
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-700">
                                    {{#if (eq language 'nb-NO')}}Sikkerhetskontroller{{else}}Security Controls{{/if}}
                                </span>
                                <span class="font-medium">{{metrics.nsm.implementedControls}}/{{metrics.nsm.securityControls}}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-700">
                                    {{#if (eq language 'nb-NO')}}Klassifisering{{else}}Classification{{/if}}
                                </span>
                                <span class="font-medium">{{metrics.nsm.classificationLevel}}</span>
                            </div>
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-700">
                                    {{#if (eq language 'nb-NO')}}Risikoscore{{else}}Risk Score{{/if}}
                                </span>
                                <span class="font-medium {{#if (lt metrics.nsm.riskScore 50)}}text-green-600{{else if (lt metrics.nsm.riskScore 75)}}text-yellow-600{{else}}text-red-600{{/if}}">
                                    {{metrics.nsm.riskScore}}/100
                                </span>
                            </div>
                        </div>
                        <div class="mt-4 text-xs text-gray-500">
                            {{#if (eq language 'nb-NO')}}Neste audit: {{formatDate (addDays metrics.timestamp 90)}}{{else}}Next audit: {{formatDate (addDays metrics.timestamp 90)}}{{/if}}
                        </div>
                    </div>

                    <!-- Norwegian Specific Compliance -->
                    <div class="regulatory-item p-6 rounded-lg">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-900">
                                {{#if (eq language 'nb-NO')}}Norsk Lovgivning{{else}}Norwegian Legislation{{/if}}
                            </h3>
                            <span class="compliance-badge compliance-good">
                                {{#if (eq language 'nb-NO')}}Overvåket{{else}}Monitored{{/if}}
                            </span>
                        </div>
                        <div class="space-y-3">
                            <div class="flex items-center text-sm">
                                <span class="w-4 h-4 rounded-full bg-green-500 mr-2"></span>
                                <span class="text-gray-700">
                                    {{#if (eq language 'nb-NO')}}Personopplysningsloven{{else}}Personal Data Act{{/if}}
                                </span>
                            </div>
                            <div class="flex items-center text-sm">
                                <span class="w-4 h-4 rounded-full bg-green-500 mr-2"></span>
                                <span class="text-gray-700">
                                    {{#if (eq language 'nb-NO')}}Sikkerhetsloven{{else}}Security Act{{/if}}
                                </span>
                            </div>
                            <div class="flex items-center text-sm">
                                <span class="w-4 h-4 rounded-full bg-green-500 mr-2"></span>
                                <span class="text-gray-700">
                                    {{#if (eq language 'nb-NO')}}Arkivloven{{else}}Archives Act{{/if}}
                                </span>
                            </div>
                        </div>
                        <div class="mt-4 text-xs text-gray-500">
                            {{#if (eq language 'nb-NO')}}Automatisk overvåkning aktivt{{else}}Automatic monitoring active{{/if}}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compliance Timeline -->
        <div class="mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-6">
                    {{#if (eq language 'nb-NO')}}Etterlevelse Tidslinje{{else}}Compliance Timeline{{/if}}
                </h2>
                
                <div class="space-y-6">
                    <!-- Upcoming Deadlines -->
                    <div class="timeline-item timeline-upcoming">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">
                                    {{#if (eq language 'nb-NO')}}GDPR Årlig Vurdering{{else}}GDPR Annual Assessment{{/if}}
                                </h3>
                                <p class="text-sm text-gray-600">
                                    {{#if (eq language 'nb-NO')}}Kreves innen 30 dager{{else}}Required within 30 days{{/if}}
                                </p>
                            </div>
                            <span class="text-sm text-yellow-600 font-medium">
                                {{#if (eq language 'nb-NO')}}Kommende{{else}}Upcoming{{/if}}
                            </span>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">
                                    {{#if (eq language 'nb-NO')}}NSM Sikkerhetskontroller Implementert{{else}}NSM Security Controls Implemented{{/if}}
                                </h3>
                                <p class="text-sm text-gray-600">
                                    {{#if (eq language 'nb-NO')}}{{metrics.nsm.implementedControls}} av {{metrics.nsm.securityControls}} kontroller{{else}}{{metrics.nsm.implementedControls}} of {{metrics.nsm.securityControls}} controls{{/if}}
                                </p>
                            </div>
                            <span class="text-sm text-green-600 font-medium">
                                {{#if (eq language 'nb-NO')}}Pågående{{else}}In Progress{{/if}}
                            </span>
                        </div>
                    </div>
                    
                    <div class="timeline-item">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">
                                    {{#if (eq language 'nb-NO')}}Sårbarhetsskanning Fullført{{else}}Vulnerability Scan Completed{{/if}}
                                </h3>
                                <p class="text-sm text-gray-600">
                                    {{#if (eq language 'nb-NO')}}{{metrics.vulnerabilities.totalScanned}} pakker skannet{{else}}{{metrics.vulnerabilities.totalScanned}} packages scanned{{/if}}
                                </p>
                            </div>
                            <span class="text-sm text-green-600 font-medium">
                                {{#if (eq language 'nb-NO')}}Fullført{{else}}Completed{{/if}}
                            </span>
                        </div>
                    </div>

                    {{#if (gt metrics.vulnerabilities.critical 0)}}
                    <div class="timeline-item timeline-overdue">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">
                                    {{#if (eq language 'nb-NO')}}Kritiske Sårbarheter Krever Handling{{else}}Critical Vulnerabilities Require Action{{/if}}
                                </h3>
                                <p class="text-sm text-gray-600">
                                    {{#if (eq language 'nb-NO')}}{{metrics.vulnerabilities.critical}} kritiske problemer{{else}}{{metrics.vulnerabilities.critical}} critical issues{{/if}}
                                </p>
                            </div>
                            <span class="text-sm text-red-600 font-medium">
                                {{#if (eq language 'nb-NO')}}Forsinket{{else}}Overdue{{/if}}
                            </span>
                        </div>
                    </div>
                    {{/if}}
                </div>
            </div>
        </div>

        <!-- Risk Assessment Matrix -->
        <div class="mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-6">
                    {{#if (eq language 'nb-NO')}}Risiko Vurdering Matrise{{else}}Risk Assessment Matrix{{/if}}
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Risk Categories -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            {{#if (eq language 'nb-NO')}}Risiko Kategorier{{else}}Risk Categories{{/if}}
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-red-500 rounded-full mr-3"></div>
                                    <span class="text-gray-800">
                                        {{#if (eq language 'nb-NO')}}Databrudd Risiko{{else}}Data Breach Risk{{/if}}
                                    </span>
                                </div>
                                <span class="text-red-600 font-semibold">
                                    {{#if (gt metrics.vulnerabilities.critical 5)}}HØY{{else if (gt metrics.vulnerabilities.critical 0)}}MIDDELS{{else}}LAV{{/if}}
                                </span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-yellow-500 rounded-full mr-3"></div>
                                    <span class="text-gray-800">
                                        {{#if (eq language 'nb-NO')}}Regulatorisk Risiko{{else}}Regulatory Risk{{/if}}
                                    </span>
                                </div>
                                <span class="text-yellow-600 font-semibold">
                                    {{#if (lt metrics.gdpr.complianceScore 70)}}HØY{{else if (lt metrics.gdpr.complianceScore 85)}}MIDDELS{{else}}LAV{{/if}}
                                </span>
                            </div>
                            
                            <div class="flex items-center justify-between p-3 bg-blue-50 rounded-lg">
                                <div class="flex items-center">
                                    <div class="w-3 h-3 bg-blue-500 rounded-full mr-3"></div>
                                    <span class="text-gray-800">
                                        {{#if (eq language 'nb-NO')}}Operasjonell Risiko{{else}}Operational Risk{{/if}}
                                    </span>
                                </div>
                                <span class="text-blue-600 font-semibold">
                                    {{#if (lt (divide (multiply metrics.nsm.implementedControls 100) metrics.nsm.securityControls) 70)}}HØY{{else if (lt (divide (multiply metrics.nsm.implementedControls 100) metrics.nsm.securityControls) 90)}}MIDDELS{{else}}LAV{{/if}}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Risk Trend Chart -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">
                            {{#if (eq language 'nb-NO')}}Risiko Trend{{else}}Risk Trend{{/if}}
                        </h3>
                        <div class="chart-container">
                            <canvas id="riskTrendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Regulatory Issues and Actions -->
        {{#if metrics.gdpr.issues}}
        <div class="mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-6">
                    {{#if (eq language 'nb-NO')}}Regelverks Problemer og Handlinger{{else}}Regulatory Issues and Actions{{/if}}
                </h2>
                
                <div class="space-y-4">
                    {{#each metrics.gdpr.issues}}
                    <div class="border rounded-lg p-4 {{#if (eq severity 'critical')}}border-red-200 bg-red-50{{else if (eq severity 'high')}}border-orange-200 bg-orange-50{{else if (eq severity 'medium')}}border-yellow-200 bg-yellow-50{{else}}border-blue-200 bg-blue-50{{/if}}">
                        <div class="flex items-start justify-between">
                            <div class="flex-1">
                                <div class="flex items-center mb-2">
                                    <span class="px-2 py-1 text-xs font-medium rounded {{#if (eq severity 'critical')}}bg-red-100 text-red-800{{else if (eq severity 'high')}}bg-orange-100 text-orange-800{{else if (eq severity 'medium')}}bg-yellow-100 text-yellow-800{{else}}bg-blue-100 text-blue-800{{/if}}">
                                        {{uppercase severity}}
                                    </span>
                                    <span class="ml-2 text-sm text-gray-600">{{category}}</span>
                                </div>
                                <h3 class="font-semibold text-gray-900 mb-2">{{description}}</h3>
                                <p class="text-gray-700 text-sm mb-3">{{recommendation}}</p>
                                {{#if regulatoryReference}}
                                <div class="text-xs text-gray-500 bg-white px-2 py-1 rounded border">
                                    {{#if (eq ../language 'nb-NO')}}Regelverks referanse: {{regulatoryReference}}{{else}}Regulatory reference: {{regulatoryReference}}{{/if}}
                                </div>
                                {{/if}}
                            </div>
                            <button class="ml-4 px-3 py-1 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded text-sm">
                                {{#if (eq ../language 'nb-NO')}}Handling{{else}}Action{{/if}}
                            </button>
                        </div>
                    </div>
                    {{/each}}
                </div>
            </div>
        </div>
        {{/if}}

        <!-- Audit Trail -->
        <div class="mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold text-gray-900 mb-6">
                    {{#if (eq language 'nb-NO')}}Audit Spor{{else}}Audit Trail{{/if}}
                </h2>
                
                <div class="audit-trail p-4 rounded-lg text-sm max-h-64 overflow-y-auto">
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-green-600">[{{formatTime generatedAt}}]</span>
                            <span class="text-gray-600">COMPLIANCE_SCAN_COMPLETED</span>
                            <span class="text-blue-600">system</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-green-600">[{{formatTime (subtractMinutes generatedAt 5)}}]</span>
                            <span class="text-gray-600">GDPR_ASSESSMENT_STARTED</span>
                            <span class="text-blue-600">compliance-service</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-green-600">[{{formatTime (subtractMinutes generatedAt 10)}}]</span>
                            <span class="text-gray-600">NSM_CONTROLS_EVALUATED</span>
                            <span class="text-blue-600">security-service</span>
                        </div>
                        {{#if (gt metrics.vulnerabilities.critical 0)}}
                        <div class="flex justify-between">
                            <span class="text-red-600">[{{formatTime (subtractMinutes generatedAt 15)}}]</span>
                            <span class="text-gray-600">CRITICAL_VULNERABILITIES_DETECTED</span>
                            <span class="text-blue-600">vulnerability-scanner</span>
                        </div>
                        {{/if}}
                        <div class="flex justify-between">
                            <span class="text-green-600">[{{formatTime (subtractMinutes generatedAt 20)}}]</span>
                            <span class="text-gray-600">LICENSE_COMPLIANCE_CHECKED</span>
                            <span class="text-blue-600">license-service</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Compliance Recommendations -->
        {{#if recommendations}}
        <div class="bg-white rounded-xl shadow-lg p-6">
            <h2 class="text-xl font-bold text-gray-900 mb-6">
                {{#if (eq language 'nb-NO')}}Etterlevelse Anbefalinger{{else}}Compliance Recommendations{{/if}}
            </h2>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                {{#each recommendations}}
                <div class="border rounded-lg p-4 {{#if (eq priority 'immediate')}}border-red-200 bg-red-50{{else if (eq priority 'high')}}border-orange-200 bg-orange-50{{else if (eq priority 'medium')}}border-yellow-200 bg-yellow-50{{else}}border-green-200 bg-green-50{{/if}}">
                    <div class="flex items-center justify-between mb-3">
                        <span class="px-2 py-1 text-xs font-medium rounded {{#if (eq priority 'immediate')}}bg-red-100 text-red-800{{else if (eq priority 'high')}}bg-orange-100 text-orange-800{{else if (eq priority 'medium')}}bg-yellow-100 text-yellow-800{{else}}bg-green-100 text-green-800{{/if}}">
                            {{uppercase priority}}
                        </span>
                        <button class="text-sm text-gray-500 hover:text-gray-700">⋯</button>
                    </div>
                    <h3 class="font-semibold text-gray-900 mb-2">{{title}}</h3>
                    <p class="text-gray-700 text-sm mb-3">{{description}}</p>
                    <div class="text-xs text-gray-600 space-y-1">
                        <div>
                            {{#if (eq ../language 'nb-NO')}}Estimert innsats: {{estimatedEffort}}{{else}}Estimated effort: {{estimatedEffort}}{{/if}}
                        </div>
                        <div>
                            {{#if (eq ../language 'nb-NO')}}Påvirkning: {{complianceImpact}}{{else}}Impact: {{complianceImpact}}{{/if}}
                        </div>
                    </div>
                </div>
                {{/each}}
            </div>
        </div>
        {{/if}}

        <!-- Footer -->
        <footer class="mt-12 text-center text-gray-500 text-sm no-print">
            <p>{{#if (eq language 'nb-NO')}}Generert av Xaheen Enterprise Compliance System - Etterlevelsesansvarlig Rapport{{else}}Generated by Xaheen Enterprise Compliance System - Compliance Officer Report{{/if}}</p>
            <p class="mt-1">{{generatedAt}}</p>
            <p class="mt-2 text-xs">
                {{#if (eq language 'nb-NO')}}Dette dokumentet inneholder sensitiv informasjon og skal behandles i henhold til NSM sikkerhetskrav{{else}}This document contains sensitive information and should be handled according to NSM security requirements{{/if}}
            </p>
        </footer>
    </div>

    <script>
        // Chart.js configuration
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        padding: 20,
                        usePointStyle: true
                    }
                }
            }
        };

        // Risk Trend Chart
        const riskTrendCtx = document.getElementById('riskTrendChart').getContext('2d');
        new Chart(riskTrendCtx, {
            type: 'line',
            data: {
                labels: [
                    {{#if (eq language 'nb-NO')}}
                    'Jan', 'Feb', 'Mar', 'Apr', 'Mai', 'Jun'
                    {{else}}
                    'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'
                    {{/if}}
                ],
                datasets: [{
                    label: {{#if (eq language 'nb-NO')}}'Samlet Risiko'{{else}}'Overall Risk'{{/if}},
                    data: [75, 70, 65, 60, 55, {{metrics.nsm.riskScore}}],
                    borderColor: '#dc2626',
                    backgroundColor: 'rgba(220, 38, 38, 0.1)',
                    tension: 0.1
                }, {
                    label: {{#if (eq language 'nb-NO')}}'GDPR Etterlevelse'{{else}}'GDPR Compliance'{{/if}},
                    data: [70, 75, 80, 85, 88, {{metrics.gdpr.complianceScore}}],
                    borderColor: '#059669',
                    backgroundColor: 'rgba(5, 150, 105, 0.1)',
                    tension: 0.1
                }]
            },
            options: {
                ...chartOptions,
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });

        // Initialize other charts from main data
        {{#each charts}}
        const {{id}}Ctx = document.getElementById('{{id}}Chart').getContext('2d');
        new Chart({{id}}Ctx, {{{json config}}});
        {{/each}}

        // Interactive functions
        function generateAuditReport() {
            // Generate comprehensive audit report
            const auditData = {
                timestamp: new Date().toISOString(),
                findings: {{json metrics}},
                recommendations: {{json recommendations}},
                officer: 'Compliance System',
                signature: 'Digital signature applied'
            };
            
            console.log('Generating audit report:', auditData);
            // In real implementation, this would generate a formal audit report
        }

        function exportCompliance() {
            // Export as PDF for regulatory submission
            window.print();
        }

        // Auto-refresh for real-time compliance monitoring
        setInterval(() => {
            // In production, this would check for compliance updates
            console.log('Checking compliance updates...');
        }, 300000); // Every 5 minutes
    </script>
</body>
</html>