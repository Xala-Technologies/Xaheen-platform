# Docker Compose configuration for {{projectName}}
# Generated by Xaheen CLI on {{timestamp}}

version: '3.8'

services:
  {{#each services}}
  {{@key}}:
    {{#if build}}
    build:
      context: {{build.context}}
      dockerfile: {{build.dockerfile}}
      {{#if build.target}}
      target: {{build.target}}
      {{/if}}
      {{#if build.args}}
      args:
        {{#each build.args}}
        {{@key}}: {{this}}
        {{/each}}
      {{/if}}
    {{/if}}
    {{#if image}}
    image: {{image}}
    {{/if}}
    {{#if container_name}}
    container_name: {{container_name}}
    {{/if}}
    {{#if restart}}
    restart: {{restart}}
    {{/if}}
    {{#if ports}}
    ports:
      {{#each ports}}
      - "{{this}}"
      {{/each}}
    {{/if}}
    {{#if environment}}
    environment:
      {{#each environment}}
      {{@key}}: {{this}}
      {{/each}}
    {{/if}}
    {{#if env_file}}
    env_file:
      {{#each env_file}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if volumes}}
    volumes:
      {{#each volumes}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if networks}}
    networks:
      {{#each networks}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if depends_on}}
    depends_on:
      {{#each depends_on}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if healthcheck}}
    healthcheck:
      test: {{healthcheck.test}}
      interval: {{healthcheck.interval}}
      timeout: {{healthcheck.timeout}}
      retries: {{healthcheck.retries}}
      start_period: {{healthcheck.start_period}}
    {{/if}}
    {{#if deploy}}
    deploy:
      {{#if deploy.replicas}}
      replicas: {{deploy.replicas}}
      {{/if}}
      {{#if deploy.resources}}
      resources:
        {{#if deploy.resources.limits}}
        limits:
          {{#each deploy.resources.limits}}
          {{@key}}: {{this}}
          {{/each}}
        {{/if}}
        {{#if deploy.resources.reservations}}
        reservations:
          {{#each deploy.resources.reservations}}
          {{@key}}: {{this}}
          {{/each}}
        {{/if}}
      {{/if}}
    {{/if}}
    {{#if labels}}
    labels:
      {{#each labels}}
      {{@key}}: {{this}}
      {{/each}}
    {{/if}}
    {{#if logging}}
    logging:
      driver: {{logging.driver}}
      {{#if logging.options}}
      options:
        {{#each logging.options}}
        {{@key}}: {{this}}
        {{/each}}
      {{/if}}
    {{/if}}
  {{/each}}

{{#if volumes}}
volumes:
  {{#each volumes}}
  {{@key}}:
    {{#if driver}}
    driver: {{driver}}
    {{/if}}
    {{#if driver_opts}}
    driver_opts:
      {{#each driver_opts}}
      {{@key}}: {{this}}
      {{/each}}
    {{/if}}
    {{#if external}}
    external: {{external}}
    {{/if}}
    {{#if labels}}
    labels:
      {{#each labels}}
      {{@key}}: {{this}}
      {{/each}}
    {{/if}}
  {{/each}}
{{/if}}

{{#if networks}}
networks:
  {{#each networks}}
  {{@key}}:
    {{#if driver}}
    driver: {{driver}}
    {{/if}}
    {{#if driver_opts}}
    driver_opts:
      {{#each driver_opts}}
      {{@key}}: {{this}}
      {{/each}}
    {{/if}}
    {{#if ipam}}
    ipam:
      driver: {{ipam.driver}}
      {{#if ipam.config}}
      config:
        {{#each ipam.config}}
        - subnet: {{subnet}}
          {{#if gateway}}
          gateway: {{gateway}}
          {{/if}}
        {{/each}}
      {{/if}}
    {{/if}}
    {{#if external}}
    external: {{external}}
    {{/if}}
    {{#if labels}}
    labels:
      {{#each labels}}
      {{@key}}: {{this}}
      {{/each}}
    {{/if}}
  {{/each}}
{{/if}}

{{#if secrets}}
secrets:
  {{#each secrets}}
  {{@key}}:
    {{#if file}}
    file: {{file}}
    {{/if}}
    {{#if external}}
    external: {{external}}
    {{/if}}
    {{#if labels}}
    labels:
      {{#each labels}}
      {{@key}}: {{this}}
      {{/each}}
    {{/if}}
  {{/each}}
{{/if}}

{{#if configs}}
configs:
  {{#each configs}}
  {{@key}}:
    {{#if file}}
    file: {{file}}
    {{/if}}
    {{#if external}}
    external: {{external}}
    {{/if}}
    {{#if labels}}
    labels:
      {{#each labels}}
      {{@key}}: {{this}}
      {{/each}}
    {{/if}}
  {{/each}}
{{/if}}