# GitLab CI/CD Configuration
# Generated by Xaheen CLI

{{#if default}}
default:
  {{#if default.image}}
  image: {{default.image}}
  {{/if}}
  {{#if default.before_script}}
  before_script:
    {{#each default.before_script}}
    - {{this}}
    {{/each}}
  {{/if}}
  {{#if default.after_script}}
  after_script:
    {{#each default.after_script}}
    - {{this}}
    {{/each}}
  {{/if}}
  {{#if default.cache}}
  cache:
    key: {{default.cache.key}}
    paths:
      {{#each default.cache.paths}}
      - {{this}}
      {{/each}}
    policy: {{default.cache.policy}}
    when: {{default.cache.when}}
  {{/if}}
  {{#if default.artifacts}}
  artifacts:
    name: {{default.artifacts.name}}
    paths:
      {{#each default.artifacts.paths}}
      - {{this}}
      {{/each}}
    {{#if default.artifacts.reports}}
    reports:
      {{#if default.artifacts.reports.junit}}
      junit:
        {{#each default.artifacts.reports.junit}}
        - {{this}}
        {{/each}}
      {{/if}}
      {{#if default.artifacts.reports.coverage_report}}
      coverage_report:
        coverage_format: {{default.artifacts.reports.coverage_report.coverage_format}}
        path: {{default.artifacts.reports.coverage_report.path}}
      {{/if}}
      {{#if default.artifacts.reports.codequality}}
      codequality:
        {{#each default.artifacts.reports.codequality}}
        - {{this}}
        {{/each}}
      {{/if}}
    {{/if}}
    expire_in: {{default.artifacts.expire_in}}
    when: {{default.artifacts.when}}
  {{/if}}
  {{#if default.tags}}
  tags:
    {{#each default.tags}}
    - {{this}}
    {{/each}}
  {{/if}}
{{/if}}

{{#if variables}}
variables:
  {{#each variables}}
  {{@key}}: {{this}}
  {{/each}}
{{/if}}

{{#if stages}}
stages:
  {{#each stages}}
  - {{this}}
  {{/each}}
{{/if}}

{{#if include}}
include:
  {{#each include}}
  {{#if local}}
  - local: {{local}}
  {{/if}}
  {{#if template}}
  - template: {{template}}
  {{/if}}
  {{#if project}}
  - project: {{project}}
    {{#if ref}}
    ref: {{ref}}
    {{/if}}
    {{#if file}}
    file: {{file}}
    {{/if}}
  {{/if}}
  {{#if remote}}
  - remote: {{remote}}
  {{/if}}
  {{/each}}
{{/if}}

{{#if services}}
services:
  {{#each services}}
  - name: {{name}}
    {{#if alias}}
    alias: {{alias}}
    {{/if}}
    {{#if entrypoint}}
    entrypoint:
      {{#each entrypoint}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if command}}
    command:
      {{#each command}}
      - {{this}}
      {{/each}}
    {{/if}}
  {{/each}}
{{/if}}

{{#if workflow}}
workflow:
  {{#if workflow.rules}}
  rules:
    {{#each workflow.rules}}
    - if: {{if}}
      {{#if when}}
      when: {{when}}
      {{/if}}
    {{/each}}
  {{/if}}
{{/if}}

{{#each jobs}}
{{@key}}:
  stage: {{stage}}
  {{#if image}}
  image: {{image}}
  {{/if}}
  {{#if services}}
  services:
    {{#each services}}
    - name: {{name}}
      {{#if alias}}
      alias: {{alias}}
      {{/if}}
    {{/each}}
  {{/if}}
  {{#if variables}}
  variables:
    {{#each variables}}
    {{@key}}: {{this}}
    {{/each}}
  {{/if}}
  {{#if before_script}}
  before_script:
    {{#each before_script}}
    - {{this}}
    {{/each}}
  {{/if}}
  script:
    {{#each script}}
    - {{this}}
    {{/each}}
  {{#if after_script}}
  after_script:
    {{#each after_script}}
    - {{this}}
    {{/each}}
  {{/if}}
  {{#if rules}}
  rules:
    {{#each rules}}
    {{#if if}}
    - if: {{if}}
    {{/if}}
    {{#if changes}}
      changes:
        {{#each changes}}
        - {{this}}
        {{/each}}
    {{/if}}
    {{#if exists}}
      exists:
        {{#each exists}}
        - {{this}}
        {{/each}}
    {{/if}}
    {{#if when}}
      when: {{when}}
    {{/if}}
    {{#if allow_failure}}
      allow_failure: {{allow_failure}}
    {{/if}}
    {{/each}}
  {{/if}}
  {{#if cache}}
  cache:
    key: {{cache.key}}
    paths:
      {{#each cache.paths}}
      - {{this}}
      {{/each}}
    {{#if cache.policy}}
    policy: {{cache.policy}}
    {{/if}}
    {{#if cache.when}}
    when: {{cache.when}}
    {{/if}}
  {{/if}}
  {{#if artifacts}}
  artifacts:
    {{#if artifacts.name}}
    name: {{artifacts.name}}
    {{/if}}
    {{#if artifacts.paths}}
    paths:
      {{#each artifacts.paths}}
      - {{this}}
      {{/each}}
    {{/if}}
    {{#if artifacts.reports}}
    reports:
      {{#if artifacts.reports.junit}}
      junit:
        {{#each artifacts.reports.junit}}
        - {{this}}
        {{/each}}
      {{/if}}
      {{#if artifacts.reports.coverage_report}}
      coverage_report:
        coverage_format: {{artifacts.reports.coverage_report.coverage_format}}
        path: {{artifacts.reports.coverage_report.path}}
      {{/if}}
      {{#if artifacts.reports.codequality}}
      codequality:
        {{#each artifacts.reports.codequality}}
        - {{this}}
        {{/each}}
      {{/if}}
      {{#if artifacts.reports.sast}}
      sast:
        {{#each artifacts.reports.sast}}
        - {{this}}
        {{/each}}
      {{/if}}
      {{#if artifacts.reports.dependency_scanning}}
      dependency_scanning:
        {{#each artifacts.reports.dependency_scanning}}
        - {{this}}
        {{/each}}
      {{/if}}
      {{#if artifacts.reports.container_scanning}}
      container_scanning:
        {{#each artifacts.reports.container_scanning}}
        - {{this}}
        {{/each}}
      {{/if}}
      {{#if artifacts.reports.dast}}
      dast:
        {{#each artifacts.reports.dast}}
        - {{this}}
        {{/each}}
      {{/if}}
      {{#if artifacts.reports.license_scanning}}
      license_scanning:
        {{#each artifacts.reports.license_scanning}}
        - {{this}}
        {{/each}}
      {{/if}}
      {{#if artifacts.reports.performance}}
      performance:
        {{#each artifacts.reports.performance}}
        - {{this}}
        {{/each}}
      {{/if}}
    {{/if}}
    {{#if artifacts.expire_in}}
    expire_in: {{artifacts.expire_in}}
    {{/if}}
    {{#if artifacts.when}}
    when: {{artifacts.when}}
    {{/if}}
  {{/if}}
  {{#if environment}}
  environment:
    name: {{environment.name}}
    {{#if environment.url}}
    url: {{environment.url}}
    {{/if}}
    {{#if environment.action}}
    action: {{environment.action}}
    {{/if}}
    {{#if environment.auto_stop_in}}
    auto_stop_in: {{environment.auto_stop_in}}
    {{/if}}
    {{#if environment.deployment_tier}}
    deployment_tier: {{environment.deployment_tier}}
    {{/if}}
  {{/if}}
  {{#if dependencies}}
  dependencies:
    {{#each dependencies}}
    - {{this}}
    {{/each}}
  {{/if}}
  {{#if needs}}
  needs:
    {{#each needs}}
    - {{this}}
    {{/each}}
  {{/if}}
  {{#if parallel}}
  parallel:
    {{#if (eq (typeof parallel) "number")}}
    {{parallel}}
    {{else}}
    matrix:
      {{#each parallel.matrix}}
      {{@key}}:
        {{#each this}}
        - {{this}}
        {{/each}}
      {{/each}}
    {{/if}}
  {{/if}}
  {{#if timeout}}
  timeout: {{timeout}}
  {{/if}}
  {{#if retry}}
  retry:
    {{#if (eq (typeof retry) "number")}}
    {{retry}}
    {{else}}
    max: {{retry.max}}
    when:
      {{#each retry.when}}
      - {{this}}
      {{/each}}
    {{/if}}
  {{/if}}
  {{#if interruptible}}
  interruptible: {{interruptible}}
  {{/if}}
  {{#if resource_group}}
  resource_group: {{resource_group}}
  {{/if}}
{{/each}}