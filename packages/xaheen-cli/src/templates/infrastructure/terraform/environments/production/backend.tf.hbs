# Backend configuration for production environment
# Generated by Xaheen CLI Terraform Generator

terraform {
  backend "{{remoteState.backend}}" {
    {{#eq remoteState.backend "s3"}}
    bucket = "{{#if remoteState.bucket}}{{remoteState.bucket}}{{else}}{{projectName}}-terraform-state{{/if}}"
    key    = "environments/production/terraform.tfstate"
    region = "{{#if remoteState.region}}{{remoteState.region}}{{else}}{{region}}{{/if}}"
    
    # Enable encryption and versioning for production
    encrypt        = true
    versioning     = true
    force_destroy  = false
    
    # DynamoDB table for state locking
    dynamodb_table = "{{projectName}}-terraform-locks"
    
    # Enable server-side encryption
    server_side_encryption_configuration {
      rule {
        apply_server_side_encryption_by_default {
          sse_algorithm = "AES256"
        }
      }
    }
    {{/eq}}
    
    {{#eq remoteState.backend "azurerm"}}
    resource_group_name  = "{{projectName}}-terraform-rg"
    storage_account_name = "{{projectName}}tfstateprod"
    container_name       = "{{#if remoteState.container}}{{remoteState.container}}{{else}}tfstate{{/if}}"
    key                  = "environments/production/terraform.tfstate"
    
    # Enable encryption for production
    use_microsoft_graph = true
    {{/eq}}
    
    {{#eq remoteState.backend "gcs"}}
    bucket = "{{#if remoteState.bucket}}{{remoteState.bucket}}{{else}}{{projectName}}-terraform-state{{/if}}"
    prefix = "environments/production"
    
    # Enable encryption for production
    encryption_key = "projects/{{projectName}}-prod/locations/global/keyRings/terraform-state/cryptoKeys/terraform-state-key"
    {{/eq}}
    
    {{#eq remoteState.backend "local"}}
    path = "./terraform-production.tfstate"
    {{/eq}}
  }
}