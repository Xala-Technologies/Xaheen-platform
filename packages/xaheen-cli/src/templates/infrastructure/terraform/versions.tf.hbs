# Terraform version constraints
# Generated by Xaheen CLI Terraform Generator
{{!-- Project: {{projectName}} --}}
{{!-- Cloud Provider: {{cloudProvider}} --}}

terraform {
  required_version = ">= 1.0"
  
  required_providers {
    {{#eq cloudProvider "aws"}}
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    {{/eq}}
    
    {{#eq cloudProvider "azure"}}
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 3.0"
    }
    
    azuread = {
      source  = "hashicorp/azuread"
      version = "~> 2.0"
    }
    {{/eq}}
    
    {{#eq cloudProvider "gcp"}}
    google = {
      source  = "hashicorp/google"
      version = "~> 4.0"
    }
    
    google-beta = {
      source  = "hashicorp/google-beta"
      version = "~> 4.0"
    }
    {{/eq}}
    
    {{#eq cloudProvider "multi-cloud"}}
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
    
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 3.0"
    }
    
    google = {
      source  = "hashicorp/google"
      version = "~> 4.0"
    }
    {{/eq}}
    
    random = {
      source  = "hashicorp/random"
      version = "~> 3.1"
    }
    
    tls = {
      source  = "hashicorp/tls"
      version = "~> 4.0"
    }
    
    {{#if security.certificateManager}}
    acme = {
      source  = "vancluever/acme"
      version = "~> 2.0"
    }
    {{/if}}
    
    {{#if monitoring.tracing}}
    datadog = {
      source  = "DataDog/datadog"
      version = "~> 3.0"
    }
    {{/if}}
  }
}

{{#eq cloudProvider "aws"}}
# AWS Provider feature requirements
provider "aws" {
  region = var.region
  
  default_tags {
    tags = {
      Project     = var.project_name
      Environment = var.environment
      ManagedBy   = "terraform"
      CreatedBy   = "xaheen-cli"
      {{#if compliance.encryption}}
      Encrypted   = "true"
      {{/if}}
      {{#if compliance.auditLogs}}
      AuditEnabled = "true"
      {{/if}}
    }
  }
}

# Additional provider for us-east-1 (required for CloudFront, ACM global certs)
provider "aws" {
  alias  = "us_east_1"
  region = "us-east-1"
  
  default_tags {
    tags = {
      Project     = var.project_name
      Environment = var.environment
      ManagedBy   = "terraform"
      CreatedBy   = "xaheen-cli"
    }
  }
}
{{/eq}}

{{#eq cloudProvider "azure"}}
# Azure Provider configuration
provider "azurerm" {
  features {
    key_vault {
      purge_soft_delete_on_destroy    = true
      recover_soft_deleted_key_vaults = true
    }
    
    resource_group {
      prevent_deletion_if_contains_resources = false
    }
    
    {{#if storage.databases}}
    postgresql_server {
      restore_point_in_time_enabled = true
    }
    
    mysql_server {
      restore_point_in_time_enabled = true
    }
    {{/if}}
    
    {{#if compute.instances}}
    virtual_machine {
      delete_os_disk_on_deletion     = true
      graceful_shutdown              = false
      skip_shutdown_and_force_delete = false
    }
    {{/if}}
  }
}

provider "azuread" {
  # AzureAD provider configuration
}
{{/eq}}

{{#eq cloudProvider "gcp"}}
# Google Cloud Provider configuration
provider "google" {
  project = var.project_id
  region  = var.region
  
  {{#if compliance.auditLogs}}
  user_project_override = true
  billing_project       = var.project_id
  {{/if}}
}

provider "google-beta" {
  project = var.project_id
  region  = var.region
  
  {{#if compliance.auditLogs}}
  user_project_override = true
  billing_project       = var.project_id
  {{/if}}
}
{{/eq}}

{{#eq cloudProvider "multi-cloud"}}
# Multi-cloud provider configuration
provider "aws" {
  region = var.aws_region
  
  default_tags {
    tags = {
      Project     = var.project_name
      Environment = var.environment
      ManagedBy   = "terraform"
      CreatedBy   = "xaheen-cli"
      Cloud       = "aws"
    }
  }
}

provider "azurerm" {
  features {
    key_vault {
      purge_soft_delete_on_destroy    = true
      recover_soft_deleted_key_vaults = true
    }
  }
}

provider "google" {
  project = var.gcp_project_id
  region  = var.gcp_region
}
{{/eq}}